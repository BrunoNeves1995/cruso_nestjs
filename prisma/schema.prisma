generator client {
  provider = "prisma-client" // Ajuste aqui
  output   = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER                                                                          // Usuário comum
  ADMIN                                                                         // Administrador
}


model User {
  id String @id @default(uuid())
  name String
  email String @unique
  password String
  avatar String?
  role Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 1 User tem varias Project
  createdProjects Project[] @relation("UserProjects")

  // 1 User tem varias Task
  tasksAssigned Task[] @relation("UsertasksAssigned")                           // Tasks assinaladas por um usuário

  // 1 User tem varias Comment
  comments Comment[]

  // N User pode ter varios N ProjectCollaborator
  collaborators ProjectCollaborator[]
}

enum CollaboratorRole {
  VIEWER                                                                       // Visualizador
  EDITOR                                                                        // Editor
  OWNER                                                                         // Dono do projeto
}

// Relacionamento N:N -> (1 Usuario ou N Usuarios) podem ter vários ( 1 Projetos ou N Projetos )
// Relacionamento N:N -> ( 1 Projetos ou N Projetos ) pode te pertencer a vários ( N Usuario ou 1 Usuario )
model ProjectCollaborator {
  id String @id @default(uuid())
  role CollaboratorRole @default(EDITOR)
  userId String
  projectId String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  project Project @relation(fields: [projectId], references: [id])

  @@unique([userId, projectId])
}


model Project {
  id String @id @default(uuid())
  name String
  description String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 1 Project tem varias Taks
  tasks Task[]

  // Relacionamento 1:N -> 1 Usuario pode ter vários N Projetos
  createdById String
  createdBy User @relation("UserProjects", fields: [createdById], references: [id])

  // N Project pode ter varios N ProjectCollaborator
  collaborators ProjectCollaborator[]
}

enum TaskStatus {
  TODO                                                                          // em aberto
  IN_PROGRESS                                                                   // em progresso
  DONE                                                                          // concluído
}

enum TaskPriority {
  LOW                                                                           // baixa
  MEDIUM                                                                        // média
  HIGH                                                                          // alta
}

model Task {
  id String @id @default(uuid())
  title String
  description String
  status TaskStatus @default(TODO)
  priority TaskPriority @default(MEDIUM)
  dueDate DateTime?                                                             // data de vencimento
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento 1:N -> 1 projeto pode ter várias Tasks e uma tarefa pertence apenas a um Project
  projectId String
  project Project @relation(fields: [projectId], references: [id])

  // Relacionamento 1:N -> 1 Usuario pode ter vários N Projetos
  assignedId String?
  assigne User? @relation("UsertasksAssigned", fields: [assignedId], references: [id])

  // 1 Task tem varias Comment
  comments Comment[]
}

model Comment {
  id String @id @default(uuid())
  content String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

   // Relacionamento 1:N -> 1 Usuario pode ter vários N Comentários
  authorId String
  author User @relation(fields: [authorId], references: [id])

   // Relacionamento 1:N -> 1 Tarefa pode ter vários N Comentários
  taskId String
  task Task @relation(fields: [taskId], references: [id])
}
